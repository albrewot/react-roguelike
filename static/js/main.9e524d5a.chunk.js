(this["webpackJsonpreact-roguelike"]=this["webpackJsonpreact-roguelike"]||[]).push([[0],{18:function(t,e,i){t.exports=i(24)},24:function(t,e,i){"use strict";i.r(e);var a=i(6),n=i.n(a),r=i(15),o=i.n(r),s=i(8),c=i(0),l=i(1),h=function(){function t(){var e=this;Object(c.a)(this,t),this.observer=[],this.handleKeys=function(t){switch(t.preventDefault(),t.keyCode){case 65:case 37:e.broadcast("move",{x:-1,y:0});break;case 87:case 38:e.broadcast("move",{x:0,y:-1});break;case 68:case 39:e.broadcast("move",{x:1,y:0});break;case 83:case 40:e.broadcast("move",{x:0,y:1})}}}return Object(l.a)(t,[{key:"subscribe",value:function(t){this.observer.push(t)}},{key:"unsubscribe",value:function(t){this.observer=this.observer.filter((function(e){return e!==t}))}},{key:"broadcast",value:function(t,e){var i=!0,a=!1,n=void 0;try{for(var r,o=this.observer[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){(0,r.value)(t,e)}}catch(s){a=!0,n=s}finally{try{i||null==o.return||o.return()}finally{if(a)throw n}}}},{key:"bindKeys",value:function(){document.addEventListener("keydown",this.handleKeys)}},{key:"unbindKeys",value:function(){document.removeEventListener("keydown",this.handleKeys)}}]),t}(),u=i(17),y=i(4),f=i(2),d=i(5),v={player:"#F00",wall:"#000"},b=i(16);function w(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}var p=function(){function t(e,i,a,n){Object(c.a)(this,t),this.x=e,this.y=i,this.size=a,this.atributes=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?w(Object(i),!0).forEach((function(e){Object(b.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):w(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},n)}return Object(l.a)(t,[{key:"action",value:function(t,e){console.log("Verb: ".concat(t))}},{key:"draw",value:function(t){t.fillStyle=this.atributes.color||"white",t.textBaseline="hanging",t.font="16px Helvetica",t.fillText(this.atributes.ascii,this.x*this.size+(this.atributes.offset?this.atributes.offset.x:0),this.y*this.size+(this.atributes.offset?this.atributes.offset.y:0))}}]),t}(),m=function(t){function e(){var t,i;Object(c.a)(this,e);for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(i=Object(y.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(n)))).atributes={name:"Player",ascii:"@",health:10},i.inventory=[],i}return Object(d.a)(e,t),Object(l.a)(e,[{key:"move",value:function(t,e){this.atributes.health<=0||(this.x+=t,this.y+=e)}},{key:"add",value:function(t){this.inventory.push(t)}},{key:"copyPlayer",value:function(){var t=new e;return Object.assign(t,this),t}}]),e}(p),g=function(){function t(e,i,a){Object(c.a)(this,t),this.width=e,this.height=i,this.tilesize=a,this.worldmap=new Array(this.width),this.entities=[new m(0,0,16)],this.history=[];for(var n=0;n<this.width;n++)this.worldmap[n]=new Array(this.height)}return Object(l.a)(t,[{key:"add",value:function(t){this.entities.push(t)}},{key:"remove",value:function(t){this.entities=this.entities.filter((function(e){return e!==t}))}},{key:"getEntityAtLocation",value:function(t,e){return this.entities.find((function(i){return i.x===t&&i.y===e}))}},{key:"moveToSpace",value:function(t){for(var e=t.x;e<this.width;e++)for(var i=t.y;i<this.height;i++)if(0===this.worldmap[e][i]&&!this.getEntityAtLocation(e,i))return t.x=e,void(t.y=i)}},{key:"movePlayer",value:function(t,e){var i=this.player.copyPlayer();i.move(t,e);var a=this.getEntityAtLocation(i.x,i.y);if(a)return console.log(a),void a.action("bump",this);this.isWall(i.x,i.y)?console.log("way blocked at ".concat(i.x,", ").concat(i.y)):this.player.move(t,e)}},{key:"isWall",value:function(t,e){return void 0===this.worldmap[t]||void 0===this.worldmap[e]||1===this.worldmap[t][e]}},{key:"createCellularMap",value:function(){var t=this,e=new u.a.Cellular(this.width,this.height,{connected:!0});e.randomize(.5);var i=function(e,i,a){0!==e&&0!==i&&e!==t.width-1&&i!==t.height-1?t.worldmap[e][i]=0===a?1:0:t.worldmap[e][i]=1};e.create(i),e.connect(i,1)}},{key:"draw",value:function(t){for(var e=0;e<this.width;e++)for(var i=0;i<this.height;i++)1===this.worldmap[e][i]&&this.drawWall(t,e,i);var a=!0,n=!1,r=void 0;try{for(var o,s=this.entities[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){o.value.draw(t)}}catch(c){n=!0,r=c}finally{try{a||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"drawWall",value:function(t,e,i){t.fillStyle=v.wall,t.fillRect(e*this.tilesize,i*this.tilesize,this.tilesize,this.tilesize)}},{key:"addToHistory",value:function(t){this.history.push(t),this.history.length>6&&this.history.shift()}},{key:"player",get:function(){return this.entities[0]}}]),t}(),O=function(t){function e(){return Object(c.a)(this,e),Object(y.a)(this,Object(f.a)(e).apply(this,arguments))}return Object(d.a)(e,t),Object(l.a)(e,[{key:"action",value:function(t,e){"bump"===t&&(e.player.add(this),e.remove(this)),"drop"===t&&console.log("drop",this)}}]),e}(p),k=function(t){function e(){return Object(c.a)(this,e),Object(y.a)(this,Object(f.a)(e).apply(this,arguments))}return Object(d.a)(e,t),Object(l.a)(e,[{key:"action",value:function(t,e){"bump"===t&&(e.addToHistory("Player attacks ".concat(this.atributes.name,"!")),this.atributes.health=this.atributes.health-1,this.atributes.health<=0?(e.remove(this),e.addToHistory("".concat(this.atributes.name," died!"))):(e.addToHistory("".concat(this.atributes.name,"'s health = ").concat(this.atributes.health)),e.player.atributes.health=e.player.atributes.health-1,e.player.atributes.health<=0?e.addToHistory("You have died"):e.addToHistory("Your current health is: ".concat(e.player.atributes.health))))}}]),e}(p),j=function(t){function e(){var t,i;Object(c.a)(this,e);for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(i=Object(y.a)(this,(t=Object(f.a)(e)).call.apply(t,[this].concat(n)))).atributes={name:"Stairs",color:"black",ascii:">",offset:{x:2,y:2}},i}return Object(d.a)(e,t),Object(l.a)(e,[{key:"action",value:function(t,e){if("bump"===t){e.addToHistory("You move down the stairs..."),e.createCellularMap(),e.player.x=0,e.player.y=0,e.moveToSpace(e.player),e.entities=e.entities.filter((function(t){return t===e.player}));var i=new P(e);i.spawnLoot(10),i.spawnMonsters(6),i.spawnStairs()}}}]),e}(p),x=[{name:"Long Sword",color:"darkgrey",ascii:"/",offset:{x:6,y:3}},{name:"Health Potion",color:"red",ascii:"!",offset:{x:6,y:3}},{name:"Gold Coin",color:"yellow",ascii:"$",offset:{x:3,y:3}},{name:"Light Armor",color:"lightgrey",ascii:"#",offset:{x:4,y:3}}],E=[{name:"Ogre",color:"lightgrey",ascii:"O",offset:{x:2,y:3},health:6},{name:"Kobold",color:"green",ascii:"k",offset:{x:4,y:3},health:3},{name:"Slime",color:"darkgreen",ascii:"S",offset:{x:3,y:2},health:2},{name:"Dragon",color:"red",ascii:"D",offset:{x:2,y:3},health:10}];function S(t){return Math.floor(Math.random()*Math.floor(t))}var P=function(){function t(e){Object(c.a)(this,t),this.world=e}return Object(l.a)(t,[{key:"spawn",value:function(t,e){for(var i=0;i<t;i++){var a=e();this.world.add(a),this.world.moveToSpace(a)}}},{key:"spawnLoot",value:function(t){var e=this;this.spawn(t,(function(){return new O(S(e.world.width-1),S(e.world.height-1),e.world.tilesize,x[S(x.length)])}))}},{key:"spawnMonsters",value:function(t){var e=this;this.spawn(t,(function(){return new k(S(e.world.width-1),S(e.world.height-1),e.world.tilesize,E[S(E.length)])}))}},{key:"spawnStairs",value:function(){var t=new j(this.world.width-10,this.world.height-10,this.world.tilesize);this.world.add(t),this.world.moveToSpace(t)}}]),t}(),z={container:{display:"flex",flexDirection:"row"},canvas:{border:"1px solid black",background:"DimGray"}},T=function(t){var e=t.width,i=t.height,r=t.tilesize,o=Object(a.useState)(new g(e,i,r)),c=Object(s.a)(o,2),l=c[0],u=c[1],y=Object(a.useRef)(),f=new h,d=function(t,e){console.log("handle input: ".concat(t," : ").concat(JSON.stringify(e)));var i=new g;Object.assign(i,l),i.movePlayer(e.x,e.y),u(i)};return Object(a.useEffect)((function(){var t=new g;Object.assign(t,l),t.createCellularMap(),t.moveToSpace(l.player);var e=new P(t);e.spawnLoot(10),e.spawnMonsters(6),e.spawnStairs(),u(t)}),[]),Object(a.useEffect)((function(){return console.log("Bind input"),f.bindKeys(),f.subscribe(d),function(){f.unbindKeys(),f.unsubscribe(d)}})),Object(a.useEffect)((function(){console.log("Draw to canvas");var t=y.current.getContext("2d");t.clearRect(0,0,e*r,i*r),l.draw(t)})),n.a.createElement("div",{style:z.container},n.a.createElement("canvas",{ref:y,width:e*r,height:i*r,style:z.canvas}),n.a.createElement("ul",null,n.a.createElement("li",null,"Inventory"),n.a.createElement("li",null,"---"),l.player.inventory.map((function(t,e){return n.a.createElement("li",{key:e},t.atributes.name)}))),n.a.createElement("ul",null,n.a.createElement("li",null,"Log"),n.a.createElement("li",null,"---"),l.history.map((function(t,e){return n.a.createElement("li",{key:e},t)}))))},L=function(){return n.a.createElement("div",null,n.a.createElement(T,{width:40,height:40,tilesize:16}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(L,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))}},[[18,1,2]]]);
//# sourceMappingURL=main.9e524d5a.chunk.js.map